{"version":3,"sources":["scripts/app.js"],"names":["angular","module","constant","X","O","EMPTY","IMPOSSIBLE","label","errors","MEDIUM","EASY","game","local","remote","login","getUser","multiplayer","score","getFBfriendsWithApp","inviteFriends","settingsCtrl","$scope","TEAMS","LEVELS","GameSettings","self","this","teams","levels","applySetting","key","value","setTeam","setLevel","params","back","text","cb","$parent","$close","component","bindings","templateUrl","controller","controllerAs","$inject","profileCtrl","ScoreService","UserService","PanelService","extractOpponents","scores","i","length","player1","facebook","id","user","opponent","player2","data","get","then","resp","err","console","log","openGameStats","open","scope","resolve","multiplayerCtrl","ApiPath","$uibModal","SocketService","$rootScope","mergeByProperty","arr1","arr2","prop","_","each","arr2Obj","found","find","arr1Obj","extend","push","initSocket","openBoard","fbFriends","getfbFriends","apply","paging","next","nextPage","chooseOpponent","users","opponentSocketId","getOpponentSocketFromValue","emit","team","getSettings","userId","on","$apply","usersOnline","map","online","name","animation","backdrop","okCb","accepter","getSocketId","challenger","$emit","openProfile","userSelected","inviteFriend","friend","invite","inviteFrom","inviteTo","removeOpponent","gameStatsCtrl","loginCtrl","$timeout","ANIMATIONS","goTo","url","a","document","createElement","click","setAttribute","style","display","body","appendChild","window","location","checkIncognitoMode","fs","RequestFileSystem","webkitRequestFileSystem","TEMPORARY","isIncognitoMode","animations","openPanel","panel","continueNotLogged","loginWithFacebook","localStorage","getItem","facebookAuth","openSettings","boardCtrl","close","avatar","img","confirmCtrl","ctrl","modalInstance","dismiss","cancelCb","VictoryModalCtrl","Game","winner","$postLink","ChooseTeamModalCtrl","choose","chooseTeam","service","validParams","element","getElementsByClassName","headerCtrl","$compile","$element","handler","forward","triflixBoardCtrl","$onInit","userMove","lockBoard","reset","getStatus","getOpponent","opponentTeam","opponentName","split","opponentMove","state","description","teamPlayer1","teamPlayer2","openModal","dismissed","makeMove","x","y","flatCoordinate","error","message","callback","modal","result","index","staticBoardCtrl","locked","chatCtrl","$document","MobileService","messages","clickEvt","chatOpened","lastMsgRead","addMessage","e","chatContainer","first","newMessage","msg","preventDefault","scrollTop","scrollHeight","socketTo","handlerDocClick","chat","draggable","removeClass","addClass","stopPropagation","isDragging","$on","off","panelContainerCtrl","$templateCache","$window","initWindow","width","innerWidth","documentElement","clientWidth","height","innerHeight","clientHeight","recalculateSize","panels","forEach","css","parent","evt","newScope","$new","elem","attr","template","append","prototype","indexOf","splice","$destroy","leftPos","remove","homeController","$watch","newVal","oldVal","showChat","svgIconDirective","svgIconService","ddo","link","attrs","$observe","icon","svg","getIcons","charAt","replaceWith","ICONS","X-icon","O-icon","directive","option","isEqual","options","siblings","unwatch","children","child","$","cell","iconEffect","toLowerCase","fn","appendTo","containment","start","event","ui","stop","$http","extUser","method","factory","tictactoe","TicTacToe","TicTacToeBoard","aiPlayer","TicTacToeAIPlayer","aiTeam","oppositePlayer","initialize","level","randomCell","getRandomCell","board","move","Error","indexes","random","api","save","isMobile","test","navigator","userAgent","substr","httpInterceptor","$location","request","config","auth","authHeader","headers","response","setItem","responseError","persistSettings","toJson","settings","fetchSettings","fetchedSettings","fromJson","sound","toUpperCase","$q","TicTacToeWrapper","ticTacToeWrapper","AImove","deferred","defer","hasEmptySlots","reject","promise","multiplayerMove","lastMove","hasemptyslots","foundOne","undefined","socket","io","connect","clb","mapObject","socketId","myLastMove","$stateProvider","$urlRouterProvider","$httpProvider","defaults","withCredentials","interceptors","otherwise","run","put"],"mappings":"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","file":"scripts/app-d49d683f6b.js","sourcesContent":[";(function(){\n  'use strict';\n\n  angular.module('triflix', [\n    'ui.router',\n    'ui.bootstrap'\n  ])\n  .constant('TEAMS',{\n    X: 'X',\n    O: 'O',\n    EMPTY: ''\n  })\n  .constant('ANIMATIONS', {\n    X: 'tada',\n    O: 'bounceIn'\n  })\n  .constant('LEVELS', {\n    IMPOSSIBLE: {\n      label: 'Hard',\n      errors: 0\n    },\n    MEDIUM: {\n      label: 'Medium',\n      errors: 1\n    },\n    EASY: {\n      label: 'Easy',\n      errors: 2\n    }\n  })\n  .constant('ApiPath', {\n    game: {\n      local: 'http://127.0.0.1:8080/jerseybackend/rest/game',\n      remote: 'https://triflixbackend.herokuapp.com/rest/game'\n    },\n    login: {\n      local: 'http://localhost:3007/auth/facebook',\n      remote: 'https://triflixbe.herokuapp.com/auth/facebook'\n    },\n    getUser: {\n      local: 'http://127.0.0.1:3007/user',\n      remote: 'https://triflixbe.herokuapp.com/user'\n    },\n    multiplayer: {\n      local: 'http://localhost:3007',\n      remote: 'https://triflixbe.herokuapp.com'\n    },\n    score: {\n      local: 'http://localhost:3007/score',\n      remote: 'https://triflixbe.herokuapp.com/score'\n    },\n    getFBfriendsWithApp: {\n      local: 'http://localhost:3007/user/me/friends',\n      remote: 'https://triflixbe.herokuapp.com/user/me/friends'\n    },\n    inviteFriends: {\n      local: 'http://localhost:3007/user/invite-friend',\n      remote: 'https://triflixbe.herokuapp.com/user/invite-friend'\n    }\n  })\n\n\n})();\n\n;(function(){\n  angular.module('triflix')\n  .component('settings', {\n    bindings: {\n    },\n    templateUrl: 'app/components/panels/settings/settings.html',\n    controller: settingsCtrl,\n    controllerAs: 'settings'\n  });\n\n  settingsCtrl.$inject = ['$scope', 'TEAMS', 'LEVELS', 'GameSettings'];\n\n  function settingsCtrl($scope, TEAMS, LEVELS, GameSettings){\n    var self = this;\n    self.teams = TEAMS;\n    self.levels = LEVELS;\n\n    self.applySetting= function(key, value){\n      if(key === 'team')\n        GameSettings.setTeam(value);\n      if(key === 'level')\n        GameSettings.setLevel(value);\n    }\n\n    self.params = {\n      back: {\n        text: 'Back',\n        cb: function(){\n          $scope.$parent.$close();\n        }\n      }\n    };\n\n\n  }\n})();\n\n;(function(){\n  angular.module('triflix')\n  .component('profile', {\n    bindings: {\n      user: '<'\n    },\n    templateUrl: 'app/components/panels/profile/profile.html',\n    controller: profileCtrl,\n    controllerAs: 'profile'\n  });\n\n  profileCtrl.$inject = ['$scope', 'ScoreService', 'UserService', 'PanelService'];\n\n  function profileCtrl($scope, ScoreService, UserService, PanelService){\n    var self = this;\n    self.user = self.user.data || self.user;\n    ScoreService.get(self.user.facebook.id)\n    .then(function(resp){\n      self.scores = resp.data;\n      extractOpponents(self.scores);\n      //return UserService.extUser(self.scores[0].player1);\n      //risolvi con $q tutti gli utenti con cui ha fatto partite\n      //oppure recupera questa informazione direttamente con una select su node\n    })\n    .then(function(resp){\n      var p = resp;\n    })\n    .catch(function(err){\n      console.log(err);\n    })\n\n    this.params = {\n      back: {\n        text: 'Back',\n        cb: function(){\n          $scope.$parent.$close();\n        }\n      }\n    };\n\n    this.openGameStats = function(score){\n      PanelService.open({\n        component: 'game-stats',\n        scope: $scope,\n        resolve: {\n          score: function(){\n            return score;\n          }\n        }\n      });\n    }\n\n    function extractOpponents(scores){\n      for(var i = 0; i < scores.length; i++){\n        if(scores[i].player1.facebook && scores[i].player1.facebook.id !== self.user.facebook.id)\n          scores[i].opponent = scores[i].player1;\n        if(scores[i].player2.facebook && scores[i].player2.facebook.id !== self.user.facebook.id)\n          scores[i].opponent = scores[i].player2;\n      }\n    }\n  }\n})();\n\n;(function(){\n  angular.module('triflix')\n  .component('multiplayer', {\n    bindings: {\n    },\n    templateUrl: 'app/components/panels/multiplayer/multiplayer.html',\n    controller: multiplayerCtrl,\n    controllerAs: 'multiplayer'\n  });\n\n  multiplayerCtrl.$inject = ['$scope', 'ApiPath', 'UserService', '$uibModal', 'PanelService'\n  , 'SocketService', '$rootScope', 'PanelService', 'GameSettings'];\n\n  function multiplayerCtrl($scope, ApiPath, UserService, $uibModal, PanelService,\n    SocketService, $rootScope, PanelService, GameSettings){\n\n    var self = this;\n    self.user = UserService.getUser();\n    var user = self.user;\n    if(!user) return $scope.$parent.$close(); //display you have to login to use this feature\n    if(!user.facebook) return $scope.$parent.$close();\n    //gestire timeout per connessione assente\n\n    SocketService.initSocket();\n\n    var openBoard = function(){\n      PanelService.open({\n        component: 'board',\n        scope: $scope\n      });\n    }\n\n    self.fbFriends = [];\n    /*funzione di paging, che scarica man mano tutti gli amici che hanno il\n    gioco installato*/\n    var getfbFriends  = function(params){\n      return UserService.getFBfriendsWithApp(params)\n      .then(function(resp){\n        [].push.apply(self.fbFriends, resp.data.data);\n        if(resp.data.paging.next)\n          getfbFriends({nextPage: resp.data.paging.next});\n      }, function(err){\n        console.log(err);\n      })\n    }\n\n\n    self.chooseOpponent = function(opponent){\n      if(self.users){\n        var opponentSocketId = SocketService.getOpponentSocketFromValue(opponent, self.users);\n        SocketService.emit('choose opponent', {team: GameSettings.getSettings().team, opponentSocketId: opponentSocketId});\n      }\n    }\n\n    getfbFriends()\n    .then(function(){\n      SocketService.emit('add to room', {\n        userId: user.facebook.id,\n        data: user\n      });\n\n      SocketService.on('add to room', function(data){\n        $scope.$apply(function(){\n          self.users = data.users;\n          self.usersOnline = _.map(data.users, function(value, key){\n            value.online = true;\n            return value;\n          })\n          //mergio gli array e sovrascrivo eventuali proprietà online = false\n          self.usersOnline = mergeByProperty(self.fbFriends, self.usersOnline, 'id');\n          //self.usersOnline = [self.usersOnline[0], self.usersOnline[0], self.usersOnline[0], self.usersOnline[0]];\n        })\n      });\n    })\n\n\n    SocketService.on('challenge request', function(data){\n      var text = 'Challenge request from '+ data.opponent.data.facebook.name;\n      $uibModal.open({\n        animation: true,\n        component: 'confirm',\n        backdrop: 'static',\n        resolve: {\n          text: [function(){\n            return text;\n          }],\n          okCb: [function(){\n            return function(){\n              SocketService.emit('challenge accepted', {\n                accepter: SocketService.getSocketId(),\n                challenger: data.opponentSocketId\n              })\n              SocketService.chooseOpponent(data);\n              $rootScope.$emit('triflix.game.start');\n              openBoard();\n            }\n          }]\n        }\n      });\n    });\n\n    SocketService.on('challenge accepted', function(opponent){\n      SocketService.chooseOpponent(opponent);\n      $rootScope.$emit('triflix.game.start');\n      openBoard();\n    })\n\n    this.openProfile = function(userSelected){\n      PanelService.open({\n        component: 'profile',\n        scope: $scope,\n        resolve: {\n          user: function(){\n            return userSelected;\n          }\n        }\n      });\n    }\n\n    this.inviteFriend = function(friend){\n      UserService.invite({\n        inviteFrom: self.user.facebook.id,\n        inviteTo: friend.data.facebook.id\n      })\n    }\n\n    function mergeByProperty(arr1, arr2, prop){\n      _.each(arr2, function(arr2Obj){\n        var found = _.find(arr1, function(arr1Obj){\n          if(arr1Obj.data.facebook[prop] === arr2Obj.data.facebook[prop])\n            return arr1Obj;\n        });\n        found ? _.extend(found, arr2Obj) : arr1.push(arr2Obj);\n      })\n      return arr1;\n    }\n    this.params = {\n      back: {\n        text: 'Back',\n        cb: function(){\n          SocketService.removeOpponent();\n          $scope.$parent.$close();\n        }\n      }\n    };\n\n\n  }\n})();\n\n;(function(){\n  angular.module('triflix')\n  .component('gameStats', {\n    bindings: {\n      score: '<'\n    },\n    templateUrl: 'app/components/panels/game-stats/game-stats.html',\n    controller: gameStatsCtrl\n  });\n\n  gameStatsCtrl.$inject = ['$scope'];\n\n\n  function gameStatsCtrl($scope){\n    var self = this;\n\n    this.params = {\n      back: {\n        text: 'Back',\n        cb: function(){\n          $scope.$parent.$close();\n        }\n      }\n    };\n\n  }\n\n})();\n\n;(function(){\n  angular.module('triflix')\n  .component('login', {\n    bindings: {\n    },\n    templateUrl: 'app/components/panels/login/login.html',\n    controller: loginCtrl,\n    controllerAs: 'login'\n  });\n\n  loginCtrl.$inject = ['$scope', 'UserService', '$timeout', 'PanelService', 'TEAMS',\n  'ANIMATIONS', 'ApiPath'];\n\n  function loginCtrl($scope, UserService, $timeout, PanelService, TEAMS, ANIMATIONS,\n  ApiPath){\n    checkIncognitoMode();\n    var isIncognitoMode = false;\n    this.teams = TEAMS;\n    this.animations = ANIMATIONS;\n    var openPanel= function(panel){\n      PanelService.open({\n        component: panel,\n        scope: $scope\n      });\n    }\n\n    var getUser = function(panel){\n      UserService.user()\n      .then(function(resp){\n        this.user = resp.data;\n        if(panel)\n          $timeout(function(){\n            openPanel(panel);\n          }, 100);\n      }, function(err){\n        console.log(err);\n      })\n    }\n    getUser('');\n\n    this.continueNotLogged = function(){\n      openPanel('board');\n    }\n\n    this.loginWithFacebook = function(){\n      if(window.localStorage.getItem('x-auth'))\n        getUser('multiplayer');\n      else\n        facebookAuth();\n    }\n\n    this.openSettings = function(){\n      openPanel('settings');\n    }\n\n    var facebookAuth = function(){\n      goTo(ApiPath.login.remote);\n    }\n\n    /*workaround per fare settare al browser l'header referer fondamentale al login\n    a node per fare il redirect corretto. con window.location non viene settato l'header referer*/\n    function goTo(url){\n      var a = document.createElement(\"a\");\n      if(!a.click) //for IE\n      {\n           window.location = url;\n           return;\n      }\n      a.setAttribute(\"href\", url);\n      a.style.display = \"none\";\n      document.body.appendChild(a);\n      a.click();\n    }\n\n    /*utile perchè in modalità incognito non funziona il localstorage*/\n    function checkIncognitoMode(){\n      var fs = window.RequestFileSystem || window.webkitRequestFileSystem;\n      if (!fs) {\n        console.log('check failed');\n        isIncognitoMode = false;\n      } else{\n        fs(window.TEMPORARY,\n           100,\n           function(){\n             isIncognitoMode = false; //not in incognito\n           },\n           function(){\n             isIncognitoMode = true; //incognito mode\n             getUser('multiplayer');\n           });\n      }\n    }\n  }\n})();\n\n;(function(){\n  angular.module('triflix')\n  .component('board', {\n    bindings: {\n    },\n    templateUrl: 'app/components/panels/board/board.html',\n    controller: boardCtrl,\n    controllerAs: 'board'\n  });\n\n  boardCtrl.$inject = ['PanelService', '$scope', '$timeout', 'UserService', '$rootScope'];\n\n  function boardCtrl(PanelService, $scope, $timeout, UserService, $rootScope){\n\n    var user = UserService.getUser();\n    var open = function(){\n      PanelService.open({\n        component: 'multiplayer',\n        scope: $scope\n      });\n\n    }\n    var close = function(){\n      //ripristino le impostaizoni utente che potrebbero essere cambiate se si sta giocando\n      //una partita in multiplayer, la team viene comandata da chi invia la richiesta di sfida\n      //bisogna ripristinarla al default\n      $rootScope.$emit('triflix.game.change.settings');\n      $scope.$parent.$close();\n    }\n\n    this.params = {\n      back: {\n        text: 'Back',\n        cb: close\n      },\n      avatar: {\n        url: user ?  (user.facebook.img || '') : ''\n      }\n    }\n  }\n})();\n\n;(function(){\n  angular.module('triflix')\n  .component('confirm', {\n    bindings: {\n      resolve: '<',\n      modalInstance: '<'\n    },\n    templateUrl: 'app/components/modals/confirm/confirm.html',\n    controller: confirmCtrl,\n    controllerAs: 'confirm'\n  });\n\n  confirmCtrl.$inject = ['$scope', 'UserService'];\n\n  function confirmCtrl($scope, UserService){\n    var ctrl = this;\n    var okCb = ctrl.resolve.okCb;\n    ctrl.resolve.okCb = function(){\n      ctrl.modalInstance.dismiss('cancel');\n      okCb();\n    }\n    ctrl.resolve.cancelCb = function(){\n      ctrl.modalInstance.dismiss('cancel');\n    }\n  }\n})();\n\n;(function(){\n  angular.module('triflix')\n  .component('victoryModal', {\n    bindings: {\n      resolve: '<'\n    },\n    templateUrl: 'app/components/modals/victory/victory.html',\n    controller: VictoryModalCtrl,\n    controllerAs: '$ctrl'\n  })\n\n  VictoryModalCtrl.$inject = ['Game'];\n\n  function VictoryModalCtrl(Game){\n    var self = this;\n\n    self.game = self.resolve.game;\n\n    /*if(self.game.winner.team === Game.TEAMS.X)\n      self.winnerImg = 'assets/images/x.png';\n    else\n      self.winnerImg = 'assets/images/o.png';\n    */\n    self.winner = self.game.winner;\n    self.$postLink = function(){\n\n    }\n\n  }\n})();\n\n;(function(){\n  angular.module('triflix')\n  .component('chooseTeamModal', {\n    bindings: {\n      modalInstance: '<',\n      resolve: '<'\n    },\n    templateUrl: 'app/components/modals/choose-team/choose-team.html',\n    controller: ChooseTeamModalCtrl,\n    controllerAs: 'chooseTeam'\n  })\n\n  ChooseTeamModalCtrl.$inject = ['Game', 'TEAMS'];\n\n  function ChooseTeamModalCtrl(Game, TEAMS){\n    var self = this;\n    //self.images = Game.IMAGES;\n\n    self.teams = TEAMS;\n    self.choose = function(team){\n      Game.chooseTeam(team);\n      self.modalInstance.close(team);\n    }\n\n    self.$postLink = function(){\n\n    }\n  }\n})();\n\n;(function(){\n  angular.module('triflix')\n  .service('PanelService', ['$rootScope',\n  function($rootScope){\n\n    var panel = angular.element(document.getElementsByClassName(\"triflix-panel\")[0]);;\n\n\n    var validParams = function(params){\n      if(!params) return false;\n      return true;\n    }\n    this.open = function(params, scope){\n      if(!validParams(params)) return;\n\n      $rootScope.$emit('triflix.addpanel', params);\n\n\n    }\n\n\n  }])\n})();\n\n;(function(){\n  angular.module('triflix')\n  .component('triflixHeader', {\n    bindings: {\n      params: '<'\n    },\n    templateUrl: 'app/components/triflix-header/triflix-header.html',\n    controller: headerCtrl,\n    controllerAs: 'header'\n  });\n\n  headerCtrl.$inject = ['$compile', '$scope', '$element'];\n  var main = '<div class=\"col-xs-12\"></div>';\n  var back = '<div class=\"col-xs-3\"></div>';\n  var forward = '<div class=\"col-xs-3 col-xs-offset-6\"></div>';\n  var avatar;\n\n  function headerCtrl($compile, $scope, $element){\n\n    this.handler = {\n      back: this.params.back && this.params.back.cb || function(){},\n      forward: this.params.forward && this.params.forward.cb || function(){}\n    };\n    //this.avatar = this.params.avatar.url || 'assets/images/fb-profile.gif';\n    this.avatar = this.params.avatar && this.params.avatar.url;\n\n\n\n  }\n\n})();\n\n;(function(){\n  angular.module('triflix')\n  .component('triflixBoard', {\n    bindings: {\n      index: '@'\n    },\n    templateUrl: 'app/components/triflix-board/triflix-board.html',\n    controller: triflixBoardCtrl,\n    controllerAs: 'board'\n  });\n\n  triflixBoardCtrl.$inject = ['$element', '$compile', '$scope', 'Game',\n  '$rootScope', '$uibModal', 'TEAMS', 'SocketService', 'ScoreService'];\n\n  function triflixBoardCtrl($element, $compile, $scope, Game, $rootScope, $uibModal,\n    TEAMS, SocketService, ScoreService){\n    var game, self = this;\n\n    this.$onInit = function(){\n      self.userMove = true;\n\n      Game.lockBoard = true;\n      Game.reset();\n      game = Game.getStatus();\n      this.game = game;\n      if(SocketService.getOpponent()){\n        //se c'è il campo opponentTeam significa che l'avversario ha scelto la squadra\n        if(SocketService.getOpponent().opponentTeam)\n          this.game.team = SocketService.getOpponent().opponentTeam === TEAMS.X ? TEAMS.O : TEAMS.X;\n\n        self.opponentName = SocketService.getOpponent().opponent.data.facebook.name.split(\" \")[0];\n        Game.lockBoard = false;\n        SocketService.on('make move', function(opponentMove){\n          $scope.$apply(function(){\n            game.state[opponentMove] = game.team === TEAMS.X ? TEAMS.O : TEAMS.X;\n            self.userMove = true;\n            if(Game.winner(game)){\n              SocketService.emit('winner or draw', {\n                description: \"test\",\n                player1: user.facebook.id,\n                player2: SocketService.getOpponent().opponent.data.facebook.id,\n                teamPlayer1: game.team,\n                teamPlayer2: SocketService.getOpponent().opponentTeam,\n                winner: game.winner.team === game.team ? user.facebook.id : SocketService.getOpponent().opponent.data.facebook.id,\n                state: game.state\n              })\n              openModal('victoryModal', function(dismissed){\n                Game.reset();\n                $rootScope.$emit('triflix.game.start');\n              });\n            }\n          })\n        });\n        SocketService.on('game aborted', function(){\n          $scope.$parent.$parent.$close();\n        })\n      }\n    }\n\n    this.makeMove = function(x, y){\n      var flatCoordinate = Game.flatCoordinate(x, y);\n      if(Game.lockBoard){\n        return;\n      }\n      if(game.state[flatCoordinate] === TEAMS.EMPTY && self.userMove){\n        self.userMove = false;\n        game.state[flatCoordinate] = game.team;\n        Game.opponentMove(game, flatCoordinate)\n        .then(function(resp){\n          _.extend(game, resp.data);\n          if(!SocketService.getOpponent()){\n            self.userMove = true;\n          }\n\n          if(game.winner && game.winner.team){\n            $rootScope.$emit('triflix.game.victory');\n            openModal('victoryModal', function(dismissed){\n              Game.reset();\n              $rootScope.$emit('triflix.game.start');\n            });\n          }\n\n        })\n        .catch(function(error){\n          if(error.message === 'draw'){\n            openModal('victoryModal', function(dismissed){\n              Game.reset();\n              $rootScope.$emit('triflix.game.start');\n              self.userMove = true;\n            });\n          } else{\n            console.log(error);\n          }\n        })\n      }\n    }\n\n\n    this.$postLink = function(){}\n\n    var openModal = function(component, callback){\n      var modal = $uibModal.open({\n        animation: true,\n        component: component,\n        resolve: {\n          game: [function(){\n            return self.game;\n          }]\n        }\n      })\n      modal.result.catch(callback)\n    }\n\n    /*var hasEmptySlots = function(state){\n      var foundOne = _.find(state, function(cell){return cell === TEAMS.EMPTY});\n      return foundOne !== undefined ? true : false;\n    }*/\n  }\n})();\n\n;(function(){\n  angular.module('triflix')\n  .component('staticBoard', {\n    bindings: {\n      state: '<',\n      locked: '@'\n    },\n    templateUrl: 'app/components/static-board/static-board.html',\n    controller: staticBoardCtrl\n  });\n\n  staticBoardCtrl.$inject = [];\n\n\n  function staticBoardCtrl(){\n    var self = this;\n\n\n  }\n\n})();\n\n;(function(){\n  angular.module('triflix')\n  .component('chat', {\n    bindings: {\n\n    },\n    templateUrl: 'app/components/chat/chat.html',\n    controller: chatCtrl\n  });\n\n  chatCtrl.$inject = ['$element', '$scope', '$rootScope', '$timeout', '$document',\n  'UserService', 'SocketService', 'MobileService'];\n\n\n  function chatCtrl($element, $scope, $rootScope, $timeout, $document, UserService,\n    SocketService, MobileService){\n    var self = this;\n    self.messages = [];\n    //var isTouch = MobileService.isMobile();\n    //var clickEvt = isTouch ? 'tap' : 'click'\n    //var clickEvt = 'touchstart click';\n    var clickEvt = 'click';\n    SocketService.on('msg to user', function(data){\n      $scope.$apply(function(){\n        self.messages.push(data);\n        if(self.chatOpened)\n          self.lastMsgRead = true;\n        else\n          self.lastMsgRead = false;\n      })\n    })\n\n    self.addMessage = function(e){\n      var chatContainer = $element.find('.chat__container').first();\n      self.user = UserService.getUser();\n      var newMessage = {\n        img: self.user.facebook.img,\n        name: self.user.facebook.name,\n        msg: self.message\n      }\n      self.messages.push(newMessage);\n      e.preventDefault(); //impedisco all'invio di andare a capo\n      //aspetto la fine di questo digest così si aggiorna il div\n      //con la nuova altezza e posso scrollare fino in basso\n      $timeout(function(){\n        chatContainer[0].scrollTop = chatContainer[0].scrollHeight; //scrollo giù\n      },0, false);\n      SocketService.emit('msg to user', _.extend({\n        socketTo: SocketService.getOpponent().opponentSocketId,\n      }, newMessage))\n      self.message = \"\";\n    }\n\n    self.$postLink = function(){\n      var chatLogo = $element.find('.chat__logo').first();\n      var chat = $element.find('.chat').first();\n      var textArea = $element.find('.chat textarea').first();\n\n      chat.on(clickEvt, function (e){\n        /*if ($(this).is('.ui-draggable-dragging')){\n          console.log('is dragging');\n          return; // in drag mode l'elemento acquisisce da jqueryUI.js questa nuova classe\n          //bisogna evitare una sovrapposizione tra click e drag\n        }*/\n        e.preventDefault();\n        e.stopPropagation();\n        if($rootScope.isDragging)\n          return $scope.$apply(function(){self.chatOpened = false;});\n\n        chat.data('draggable') && chat.draggable('disable');\n        $scope.$apply(function(){\n          var chatOpened = true;\n          self.lastMsgRead = true;\n          chat.removeClass('chat__closed').addClass('chat__opened')\n          $timeout(function(){self.chatOpened = chatOpened}, 1000);\n        })\n      });\n\n\n      $document.on(clickEvt, handlerDocClick);\n\n      $scope.$on('$destroy', function(){\n        $document.off('click', handlerDocClick);\n      })\n\n      function handlerDocClick(){\n        chat.data('draggable') && chat.draggable('enable');\n        $scope.$apply(function(){\n          if(self.chatOpened){\n            self.chatOpened = false;\n            chat.removeClass('chat__opened').addClass('chat__closed');\n          }\n        })\n      }\n\n    }\n  }\n\n})();\n\n;(function(){\n  angular.module('triflix')\n  .component('panelContainer', {\n    bindings: {\n    },\n    controller: panelContainerCtrl,\n    controllerAs: 'panel'\n  });\n\n  panelContainerCtrl.$inject = ['$element', '$scope', '$rootScope', '$templateCache', '$compile',\n   '$window', '$timeout'];\n\n  function panelContainerCtrl($element, $scope, $rootScope, $templateCache, $compile,\n    $window, $timeout){\n\n\n      var width, height, leftPos;\n\n      function initWindow(){\n        width = window.innerWidth\n        || document.documentElement.clientWidth\n        || document.body.clientWidth;\n\n        height = window.innerHeight\n        || document.documentElement.clientHeight\n        || document.body.clientHeight;\n      }\n      initWindow();\n\n      this.$onInit = function(){\n        $element.css('position', 'absolute');\n        $element.css('width', width);\n        $element.css('height', height);\n        $element.css('top', '0px');\n        $element.css('left', -width + 'px');\n      }\n\n      var panels = [];\n      $rootScope.$on('triflix.addpanel', function(evt, params){\n        var newScope = $rootScope.$new();\n        var elem = angular.element('<div></div>');\n        elem.css('float', 'left');\n        elem.css('width', width);\n        elem.css('height', height);\n\n        if(params.controller){\n          var ctrl = angular.element('<div></div>');\n          ctrl.attr('ng-controller', params.controller);\n          var template = $templateCache.get(params.templateUrl);\n          ctrl.append(angular.element(template));\n          elem.append(ctrl);\n        }\n        else if(params.component){\n          var component = '<' + params.component;\n          if(params.resolve && typeof(params.resolve) === \"object\"){\n            for(var key in params.resolve){\n              newScope['resolved' + key] = params.resolve[key]();\n              component += ' ' + key + '=\"resolved' + key + '\"';\n            }\n          }\n          component += '></' + params.component + '>';\n          elem.append(component);\n        }\n\n\n        newScope.prototype = params.scope;\n        newScope.$close = function(){\n          var index = panels.indexOf(panel);\n          panels.splice(index, 1);\n          panel.scope().$destroy();\n          var leftPos = panels.length ? -width * (panels.length - 1) : 0;\n\n          $element.css('left', leftPos);\n          $timeout(function(){\n            panel.remove();\n            $element.css('width', width * panels.length);\n          }, 500);\n\n        }\n        var panel = $compile(elem)(newScope);\n        panels.push(panel);\n\n        $element.parent().css('position', 'relative');\n        $element.parent().css('overflow-x', 'hidden');\n        $element.parent().css('width', width);\n        $element.parent().css('height', height);\n\n        $element.css('width', width * panels.length);\n        $element.append(panel);\n        var leftPos = -width * (panels.length - 1);\n\n        $element.css('left', leftPos);\n\n      });\n\n      this.$postLink = function(){\n        angular.element($window).on('resize', recalculateSize);\n      }\n\n      function recalculateSize(){\n        initWindow();\n        panels.forEach(function(panel){\n          panel.css('height', height);\n          panel.css('width', width);\n        })\n\n        $element.css('height', height);\n        $element.css('width', width * panels.length);\n        $element.css('left', (- width * (panels.length - 1)));\n        $element.parent().css('height', height);\n        $element.parent().css('width', width);\n      }\n  }\n})();\n\n(function(){\n  'use strict';\n\n  angular.module('triflix')\n  .controller('HomeController', homeController);\n\n  homeController.$inject = ['$scope', 'PanelService', '$timeout', 'SocketService'];\n\n  function homeController($scope, PanelService, $timeout, SocketService){\n    var self = this;\n\n    $timeout(function(){\n      PanelService.open({\n        component: 'login',\n        scope: $scope\n      });\n    })\n\n    $scope.$watch(function(){\n      return SocketService.getOpponent()\n    }, function(newVal, oldVal){\n      if(newVal)\n        self.showChat = true;\n      else\n        self.showChat = false;\n    })\n  }\n})();\n\n;(function(){\n  angular.module('triflix')\n  .directive('svgIcon', svgIconDirective)\n  .service('svgIconService', svgIconService);\n\n  svgIconDirective.$inject = ['svgIconService', 'ANIMATIONS'];\n  svgIconService.$inject = [];\n\n\n  function svgIconDirective(svgIconService, ANIMATIONS){\n    var ddo = {\n      link: function(scope, elem, attrs){\n        attrs.$observe('svgIcon', function(icon){\n          var svg = svgIconService.getIcons()[icon];\n          if(svg){\n            svg = angular.element(svg);\n            svg.css('width', attrs.width ? attrs.width + 'px' : '64px');\n            var animation = ANIMATIONS[icon.charAt(0)];\n            svg.attr('class','animated '+animation);\n            elem.replaceWith(svg);\n          }\n        })\n      }\n    }\n    return ddo;\n  }\n\n  function svgIconService(){\n    var ICONS = {\n      'X-icon': \"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><polygon fill='#DB9E36' fill-rule='nonzero' points='100 11.5399943 88.4595969 0 50.0001022 38.4599035 11.5404031 0 0 11.5399943 38.4596991 50.0001022 0 88.4595969 11.5406074 100 50.0001022 61.5403009 88.4595969 100 99.9997956 88.4595969 61.5403009 50.0001022'></polygon></svg>\",\n      'O-icon': \"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle stroke='#DC3522' stroke-width='14' fill='transparent' cx='50' cy='50' r='43' /></svg>\"\n    }\n    this.getIcons = function(){\n      return ICONS;\n    }\n  }\n\n})();\n\n;(function(){\n  angular.module('triflix')\n  .directive('selectOption', ['GameSettings', function(GameSettings){\n    /*paint the background of a selected option in the setting panel */\n    var ddo = {\n      scope: {\n        option: '@selectOption',\n        value: '=selectOptionValue'\n      },\n      link: function(scope, elem, attrs){\n        if(_.isEqual(GameSettings.getSettings()[scope.option], scope.value))\n          elem.addClass('settings__content__el__selected');\n\n        elem.on('click', function(){\n          var options = elem.siblings();\n          options.removeClass('settings__content__el__selected');\n          elem.addClass('settings__content__el__selected');\n        })\n\n      }\n    }\n    return ddo;\n  }])\n\n})();\n\n;(function(){\n  angular.module('triflix')\n  .directive('refreshBoard', ['$rootScope', 'SocketService', function($rootScope, SocketService){\n    var ddo = {\n      link: function(scope, elem, attrs){\n        /*remove all the classes and icons from the board everytime you start the game*/\n\n        var unwatch = $rootScope.$on('triflix.game.start', function(){\n          elem.children().removeClass('board__cell--selected board__cell--o board__cell--x');\n          angular.forEach(elem.children(), function(child){\n            $(child).find('.icon').remove();\n          })\n        })\n\n        scope.$on('$destroy', function(){\n          unwatch();\n        })\n\n        if(SocketService.getOpponent()){\n          //se multiplayer levo subito le icone di esempio\n          $rootScope.$emit('triflix.game.start');\n        }\n      }\n    }\n    return ddo;\n  }])\n})();\n\n;(function(){\n  angular.module('triflix')\n  .directive('paintCell', ['Game', '$compile', 'ANIMATIONS',\n    function(Game, $compile, ANIMATIONS){\n    /*paint a single cell on the board*/\n    var ddo = {\n      scope: {\n        cell: '=paintCell',\n        game: '='\n      },\n      link: function(scope, elem, attrs){\n        var icon = angular.element('<span class=\"icon animated {{iconEffect}}\"></span>');\n\n        scope.$watch('cell', function(newVal){\n          if(!newVal) return;\n          scope.iconEffect = ANIMATIONS[scope.cell] || 'bounceIn';\n          elem.removeClass('board__cell--x board__cell--o');\n          elem.addClass('board__cell--selected board__cell--'+scope.cell.toLowerCase());\n          elem.append($compile(icon)(scope));\n\n        })\n\n\n      }\n    }\n    return ddo;\n  }])\n\n\n\n})();\n\n;(function(){\n  angular.module('triflix')\n  .directive('lockBoard', ['$uibModal', 'Game', '$rootScope', 'SocketService',\n    function($uibModal, Game, $rootScope, SocketService){\n\n    /*Lock the board until you choose a team through the ChooseTeam modal component*/\n\n    var ddo = {\n      link: function(scope, elem, attrs){\n        if(!SocketService.getOpponent())\n          elem.on('click', fn);\n          \n        function fn(evt){\n          /*var modal = $uibModal.open({\n            animation: true,\n            component: 'chooseTeamModal',\n            backdrop: 'static',\n            resolve: {}\n          });\n          modal.result.then(function(res){\n            elem.off('click', fn);\n            Game.lockBoard = false; //unlock board\n            $rootScope.$emit('triflix.game.start');\n          })\n          .catch(function(res){\n\n          })*/\n          elem.off('click', fn);\n          Game.lockBoard = false; //unlock board\n          $rootScope.$emit('triflix.game.start');\n        }\n\n      }\n\n\n    }\n    return ddo;\n  }])\n\n})();\n\n;(function(){\n  angular.module('triflix')\n  .directive('draggable', ['$rootScope', function($rootScope){\n    var ddo = {\n      link: function(scope, elem, attrs){\n        elem.draggable({\n          appendTo: \"body\",\n          containment: \"body\",\n          start: function( event, ui ) {\n            scope.$apply(function(){\n              $rootScope.isDragging = true;\n            })\n          },\n          stop: function( event, ui ) {\n            scope.$apply(function(){\n              $rootScope.isDragging = false;\n            })\n          }\n        });\n      }\n\n    }\n    return ddo;\n  }])\n\n})();\n\n;(function(){\n  angular.module('triflix')\n  .service('UserService', UserService);\n\n  UserService.$inject = ['$http', 'ApiPath'];\n\n  function UserService($http, ApiPath){\n\n    var user;\n\n    this.getUser = function(){\n      return user;\n    }\n\n    this.extUser = function(id){\n      return $http({\n        method: 'GET',\n        url: ApiPath.getUser.remote,\n        params: id\n      })\n    }\n\n    this.getFBfriendsWithApp = function(params){\n      return $http({\n        method: 'GET',\n        url: ApiPath.getFBfriendsWithApp.remote,\n        params: params\n      })\n    }\n    this.invite = function(params){\n      return $http({\n        method: 'GET',\n        url: ApiPath.inviteFriends.remote,\n        params: params\n      })\n    }\n    this.user = function(id){\n      return $http({\n        method: 'GET',\n        url: ApiPath.getUser.remote\n      }).then(function(resp){\n        if(!resp.data.error)\n          user = resp.data;\n        return resp;\n      }, function(err){\n        return err;\n      });\n    };\n\n  }\n})();\n\n;(function(){\n\n  angular.module('triflix')\n  .factory('TicTacToeWrapper', ['LEVELS', 'TEAMS', function(LEVELS, TEAMS){\n\n    function makeMove(game){\n      var tictactoe = new TicTacToe.TicTacToeBoard(game.state);\n      var aiPlayer = new TicTacToe.TicTacToeAIPlayer();\n      var aiTeam = tictactoe.oppositePlayer(game.team);\n      aiPlayer.initialize(aiTeam, tictactoe);\n      var winner = tictactoe.winner();\n      if(!winner){\n        if(!_.isEqual(game.level, LEVELS.IMPOSSIBLE) && this.errors < game.level.errors){\n          var randomCell = getRandomCell(game);\n          tictactoe.board[randomCell] = aiTeam;\n          this.errors++;\n        }\n        else{\n          var move = aiPlayer.makeMove();\n          if(move != null){\n            tictactoe.makeMove(aiTeam, move);\n          } else {\n            throw new Error('invalid move');\n          }\n        }\n        winner = tictactoe.winner();\n      }\n      return {\n        data: {\n          team: game.team,\n          state: tictactoe.board,\n          winner: {\n            team: winner ? winner.cell : '',\n            indexes: winner ? winner.indexes : []\n          }\n        }\n      }\n    }\n\n    function getRandomCell(game){\n      var found = false,\n          cell;\n      while(!found){\n        cell = _.random(0, 8);\n        found = game.state[cell] === TEAMS.EMPTY ? true : false;\n      }\n\n      return cell;\n    }\n\n    return function(){\n      this.errors = 0;\n      this.makeMove = makeMove;\n      this.winner = function(game){\n        var tictactoe = new TicTacToe.TicTacToeBoard(game.state);\n        var aiPlayer = new TicTacToe.TicTacToeAIPlayer();\n        var aiTeam = tictactoe.oppositePlayer(game.team);\n        aiPlayer.initialize(aiTeam, tictactoe);\n        return tictactoe.winner();\n      }\n    }\n\n\n  }])\n\n\n})();\n\n;(function(){\n  angular.module('triflix')\n  .service('ScoreService', ScoreService);\n\n  ScoreService.$inject = ['ApiPath', '$http'];\n\n  function ScoreService(ApiPath, $http){\n    var api = ApiPath.score.remote;\n    this.save = function(body){\n      return $http({\n        url: api,\n        method: 'POST',\n        data: body\n      })\n    }\n\n    this.get = function(userId){\n      return $http({\n        url: api,\n        method: 'GET',\n        params: {\n          id: userId\n        }\n      })\n    }\n\n  }\n})();\n\n;(function(){\n  angular.module('triflix')\n  .service('MobileService', MobileService);\n\n  MobileService.$inject = [];\n\n  function MobileService(){\n    var isMobile = false; //initiate as false\n    // device detection\n    if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)\n        || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(navigator.userAgent.substr(0,4))) isMobile = true;\n\n    this.isMobile = function(){\n      return isMobile;\n    }\n\n  }\n})();\n\n;(function(){\n  angular.module('triflix')\n    .factory('httpInterceptor', httpInterceptor);\n\n    httpInterceptor.$inject = ['$location'];\n    var authHeader = 'x-auth';\n    function httpInterceptor($location){\n      return {\n        request: function(config){\n          var auth = window.localStorage.getItem(authHeader);\n          if(auth)\n            config.headers[authHeader] = auth;\n          return config;\n        },\n        response: function(response){\n          var auth = response.headers()[authHeader];\n          if(auth)\n            window.localStorage.setItem(authHeader, auth);\n          return response;\n        },\n        responseError: function(response){\n          return response;\n        }\n      }\n    }\n\n})();\n\n;(function(){\n  angular.module('triflix')\n  .service('GameSettings', GameSettings);\n\n  GameSettings.$inject = ['TEAMS', 'LEVELS', '$rootScope'];\n  /*setting panel for the game*/\n\n  function GameSettings(TEAMS, LEVELS, $rootScope){\n\n    var settings = fetchSettings();\n\n    this.setTeam = function(team){\n      settings.team = TEAMS[team.toUpperCase()] || TEAMS.X;\n      $rootScope.$emit('triflix.game.change.settings');\n      persistSettings();\n    }\n    this.setLevel = function(level){\n      settings.level = LEVELS[level.toUpperCase()] || LEVELS.IMPOSSIBLE;\n      $rootScope.$emit('triflix.game.change.settings');\n      persistSettings();\n    }\n    this.getSettings = function(){\n      return settings;\n    }\n\n    function persistSettings(){\n      localStorage.setItem('settings', angular.toJson(settings));\n    }\n    function fetchSettings(){\n      var fetchedSettings = localStorage.getItem('settings');\n      if(fetchedSettings){\n        return angular.fromJson(fetchedSettings);\n      } else{\n        return {\n          team: TEAMS.X,\n          level: LEVELS.IMPOSSIBLE,\n          sound: 'off'\n        }\n      }\n    }\n\n  }\n})();\n\n;(function(){\n  angular.module('triflix')\n  .service('Game', Game);\n\n  Game.$inject = ['$http', 'TEAMS', 'LEVELS', 'GameSettings', '$timeout', 'ApiPath', '$q',\n   'SocketService', '$rootScope', 'TicTacToeWrapper'];\n\n  function Game($http, TEAMS, LEVELS, GameSettings, $timeout, ApiPath, $q, SocketService,\n    $rootScope, TicTacToeWrapper){\n\n    var ticTacToeWrapper, self = this;\n    game = {};\n    game.team = GameSettings.getSettings().team;\n    game.level = GameSettings.getSettings().level;\n    game.state = ['','','','','','','','',''];\n    game.winner = {};\n    this.lockBoard = true;\n\n\n    var AImove = function(game){\n      var deferred = $q.defer();\n      $timeout(function(){\n        try{\n          if(!self.hasEmptySlots(game.state)){\n            return deferred.reject(new Error('draw'));\n          }\n          var result = ticTacToeWrapper.makeMove(game);\n          deferred.resolve(result);\n        }\n        catch(error){\n          deferred.reject(error);\n        }\n      }, 800);\n      return deferred.promise;\n    }\n\n    var multiplayerMove = function(game, lastMove){\n      var hasemptyslots = self.hasEmptySlots(game.state);\n      self.winner(game);\n      return SocketService.makeMove(game, lastMove, hasemptyslots);\n    }\n    this.opponentMove = function(game, lastMove){\n      if(SocketService.getOpponent()){\n        return multiplayerMove(game, lastMove);\n      } else{\n        return AImove(game);\n      }\n\n    }\n\n    this.reset = function(){\n      game.state = ['','','','','','','','',''];\n      game.winner = {};\n      ticTacToeWrapper = new TicTacToeWrapper();\n    }\n\n    this.flatCoordinate = function(x, y){\n      return x + (y * 3);\n    }\n\n    this.getStatus = function(){\n      return game;\n    }\n\n    this.hasEmptySlots = function(state){\n      var foundOne = _.find(state, function(cell){return cell === TEAMS.EMPTY});\n      return foundOne !== undefined ? true : false;\n    }\n    this.winner = function(game){\n      game.winner = ticTacToeWrapper.winner(game);\n      if(game.winner){\n        game.winner.team = game.winner.cell;\n        delete game.winner.cell;\n      }\n      return game.winner;\n    }\n\n    /* events */\n    $rootScope.$on('triflix.game.change.settings', function(evt, data){\n      game.team = GameSettings.getSettings().team;\n      game.level = GameSettings.getSettings().level;\n    })\n  }\n})();\n\n;(function(){\n  angular.module('triflix')\n  .service('SocketService', SocketService);\n\n  SocketService.$inject = ['ApiPath', '$timeout', '$q', 'TEAMS', '$rootScope'];\n\n  function SocketService(ApiPath, $timeout, $q, TEAMS, $rootScope){\n\n    var socket, opponent;\n    this.initSocket = function(){\n      if(!window.io)\n        return console.log('socket.io not loaded');\n      if(!socket){\n        socket = io.connect(ApiPath.multiplayer.remote);\n        this.on('disconnect', function(){\n          socket = null;\n        })\n      }\n    }\n    this.emit = function(evt, data){\n      socket.emit(evt, data);\n    }\n    this.on = function(evt, clb){\n      socket.on(evt, clb);\n    }\n    this.getSocketId = function(){\n        return socket.id;\n    }\n    this.chooseOpponent = function(challenger){\n      opponent = challenger;\n    }\n    this.removeOpponent = function(){\n      opponent = null;\n    }\n    this.getOpponentSocketFromValue = function(opponent, users){\n      var opponentSocketId = -1;\n      _.mapObject(users, function(user, socketId){\n        if(user.userId === opponent.userId)\n          opponentSocketId = socketId;\n      });\n      return opponentSocketId;\n    }\n\n    this.getOpponent = function(){\n      return opponent;\n    }\n\n    this.makeMove = function(game, myLastMove, hasEmptySlots){\n      var deferred = $q.defer();\n      if(!hasEmptySlots){\n        deferred.reject(new Error('draw'));\n      }\n      socket.emit('make move', {move: myLastMove, opponent: opponent});\n      deferred.resolve({data: game});\n      /*socket.on('make move', function(opponentMove){\n        $rootScope.$apply(function(){\n          game.state[opponentMove] = game.team === TEAMS.X ? TEAMS.O : TEAMS.X;\n          deferred.resolve({data: game});\n        })\n      })*/\n      return deferred.promise;\n    }\n\n\n  }\n})();\n\n;(function(){\n  angular.module('triflix')\n  .config(config);\n\n  config.$inject = ['$stateProvider', '$urlRouterProvider', '$httpProvider'];\n  function config($stateProvider, $urlRouterProvider, $httpProvider){\n    $httpProvider.defaults.withCredentials = true;\n    $httpProvider.interceptors.push('httpInterceptor');\n\n    $stateProvider\n      .state('home', {\n        url: '/',\n        templateUrl: 'app/home/home.html',\n        controller: 'HomeController as homeCtrl'\n      });\n\n    $urlRouterProvider.otherwise('/');\n  }\n})();\n\nangular.module(\"triflix\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/home/home.html\",\"<div class=panelParent><panel-container class=panel-container></panel-container></div><chat ng-if=homeCtrl.showChat></chat><!--\\n\\n<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" style=\\\"display: none\\\">\\n\\n  <symbol id=\\\"o\\\" viewBox=\\\"0 0 100 100\\\">\\n    <circle cx=\\\"50\\\" cy=\\\"50\\\" r=\\\"43\\\" />\\n  </symbol>\\n\\n  <symbol id=\\\"x\\\" viewbox=\\\"0 0 100 100\\\">\\n    <polygon fill-rule=\\\"nonzero\\\" points=\\\"100 11.5399943 88.4595969 0 50.0001022 38.4599035 11.5404031 0 0 11.5399943 38.4596991 50.0001022 0 88.4595969 11.5406074 100 50.0001022 61.5403009 88.4595969 100 99.9997956 88.4595969 61.5403009 50.0001022\\\"></polygon>\\n  </symbol>\\n\\n</svg>\\n\\n-->\");\n$templateCache.put(\"app/components/chat/chat.html\",\"<div class=chat><div style=\\\"position: relative; width: 100%; height: 100%\\\"><img ng-show=!$ctrl.chatOpened class=chat__logo ng-src=assets/images/chat.png alt=\\\"no img\\\"> <img ng-if=\\\"$ctrl.lastMsgRead === false\\\" ng-src=assets/images/one-message.png class=chat__toread alt=\\\"no img\\\"><div ng-if=$ctrl.chatOpened style=\\\"text-align: center; color: grey\\\">Today</div><div ng-if=$ctrl.chatOpened class=chat__container><div ng-repeat=\\\"message in $ctrl.messages\\\" style=\\\"overflow: auto;\\n        margin-bottom: 10px\\\" ng-style=\\\"$first && {\\'margin-top\\': \\'10px\\'}\\\"><div class=chat__col2><img class=chat__userImg ng-src={{message.img}} width=32 alt=\\\"no img\\\"></div><div class=chat__col10><span class=chat__username>{{message.name}}</span> <span class=chat__message>{{message.msg}}</span></div></div></div><div class=chat__textarea ng-if=$ctrl.chatOpened><textarea ng-keydown=\\\"$event.keyCode === 13 && $ctrl.message && $ctrl.addMessage($event)\\\" ng-model=$ctrl.message placeholder=Message..></textarea></div></div></div>\");\n$templateCache.put(\"app/components/triflix-board/triflix-board.html\",\"<div class=col-sm-12><div class=header><h1>TicTacToe</h1><p ng-if=board.userMove>It\\'s <b>your</b> turn</p><p ng-if=\\\"!board.userMove && !board.opponentName\\\"><b>AI</b> turn</p><p ng-if=\\\"!board.userMove && board.opponentName\\\"><b>{{board.opponentName}}</b> turn</p><!--<p>Cras ultricies ligula sed magna dictum porta.</p>--></div></div><div lock-board><div class=board refresh-board><div ng-click=board.makeMove(0,0) paint-cell=board.game.state[0] game=board.game class=\\\"board__cell board__cell--selected board__cell--o\\\"><span class=\\\"icon animated bounceIn\\\"></span></div><div ng-click=board.makeMove(0,1) paint-cell=board.game.state[3] game=board.game class=board__cell></div><div ng-click=board.makeMove(0,2) paint-cell=board.game.state[6] game=board.game class=\\\"board__cell board__cell--selected board__cell--x\\\"><span class=\\\"icon animated tada\\\"></span></div><div ng-click=board.makeMove(1,0) paint-cell=board.game.state[1] game=board.game class=board__cell></div><div ng-click=board.makeMove(1,1) paint-cell=board.game.state[4] game=board.game class=board__cell></div><div ng-click=board.makeMove(1,2) paint-cell=board.game.state[7] game=board.game class=board__cell></div><div ng-click=board.makeMove(2,0) paint-cell=board.game.state[2] game=board.game class=board__cell></div><div ng-click=board.makeMove(2,1) paint-cell=board.game.state[5] game=board.game class=board__cell></div><div ng-click=board.makeMove(2,2) paint-cell=board.game.state[8] game=board.game class=board__cell></div></div></div>\");\n$templateCache.put(\"app/components/static-board/static-board.html\",\"<div><div class=board><div paint-cell=$ctrl.state[0] game=$ctrl.state class=board__cell></div><div paint-cell=$ctrl.state[3] game=$ctrl.state class=board__cell></div><div paint-cell=$ctrl.state[6] game=$ctrl.state class=board__cell></div><div paint-cell=$ctrl.state[1] game=$ctrl.state class=board__cell></div><div paint-cell=$ctrl.state[4] game=$ctrl.state class=board__cell></div><div paint-cell=$ctrl.state[7] game=$ctrl.state class=board__cell></div><div paint-cell=$ctrl.state[2] game=$ctrl.state class=board__cell></div><div paint-cell=$ctrl.state[5] game=$ctrl.state class=board__cell></div><div paint-cell=$ctrl.state[8] game=$ctrl.state class=board__cell></div><div ng-if=$ctrl.locked class=board__overlay></div></div></div>\");\n$templateCache.put(\"app/components/triflix-header/triflix-header.html\",\"<div class=\\\"col-sm-12 triflix-header\\\"><div class=\\\"col-xs-4 triflix-header--button\\\" ng-click=header.handler.back() ng-show=header.params.back><i class=\\\"fa fa-arrow-left\\\" aria-hidden=true></i> <span>Back</span></div><div class=\\\"col-xs-4 text-center\\\"><img ng-show=header.avatar ng-src={{header.avatar}} width=32 height=24 class=img-circle alt=\\\"no img\\\"></div><div class=\\\"col-xs-4 triflix-header--button\\\" ng-click=header.handler.forward() ng-show=header.params.forward><div class=pull-right><i class=\\\"fa fa-arrow-right\\\" aria-hidden=true></i> <span>Forward</span></div></div></div>\");\n$templateCache.put(\"app/components/modals/choose-team/choose-team.html\",\"<div class=triflix-modal><div class=triflix-modal--header><h3 class=triflix-modal--title>Choose a team</h3></div><div class=triflix-modal--body><div ng-repeat=\\\"team in chooseTeam.teams\\\" ng-click=chooseTeam.choose(team) style=display:inline><span svg-icon={{team}}-icon width=64></span></div></div></div>\");\n$templateCache.put(\"app/components/modals/confirm/confirm.html\",\"<div class=triflix-modal><div class=triflix-modal--header><h3 class=triflix-modal--header--title>Heading</h3></div><div class=triflix-modal--body><h2>{{confirm.resolve.text}}</h2><button style=\\\"width: 25%\\\" class=\\\"btn btn-success\\\" ng-click=confirm.resolve.okCb()>Ok</button> <button style=\\\"width: 25%\\\" class=\\\"btn btn-danger\\\" ng-click=confirm.resolve.cancelCb()>Cancel</button></div></div>\");\n$templateCache.put(\"app/components/modals/victory/victory.html\",\"<div class=triflix-modal><div class=triflix-modal--header><h3 ng-if=$ctrl.winner.team class=triflix-modal--title>We have a winner</h3><h3 ng-if=!$ctrl.winner.team class=triflix-modal--title>Draw :(</h3></div><div ng-if=$ctrl.winner.team class=triflix-modal--body>Player <span svg-icon={{$ctrl.winner.team}}-icon width=32></span> win the game</div><div ng-if=!$ctrl.winner.team class=triflix-modal--body>Play again!</div></div><!--<div class=\\\"modal-header\\\">\\n    <h3 class=\\\"modal-title\\\" id=\\\"modal-title\\\">I\\'m a modal!</h3>\\n</div>\\n<div class=\\\"modal-body\\\" id=\\\"modal-body\\\">\\n    <ul>\\n        <li ng-repeat=\\\"item in $ctrl.items\\\">\\n            <a href=\\\"#\\\" ng-click=\\\"$event.preventDefault(); $ctrl.selected.item = item\\\">{{ item }}</a>\\n        </li>\\n    </ul>\\n    Selected: <b>{{ $ctrl.selected.item }}</b>\\n</div>\\n<div class=\\\"modal-footer\\\">\\n    <button class=\\\"btn btn-primary\\\" type=\\\"button\\\" ng-click=\\\"$ctrl.ok()\\\">OK</button>\\n    <button class=\\\"btn btn-warning\\\" type=\\\"button\\\" ng-click=\\\"$ctrl.cancel()\\\">Cancel</button>\\n</div>-->\");\n$templateCache.put(\"app/components/panels/board/board.html\",\"<triflix-header params=board.params ng-if=board.params></triflix-header><triflix-board class=col-sm-12 index=0></triflix-board>\");\n$templateCache.put(\"app/components/panels/game-stats/game-stats.html\",\"<triflix-header params=$ctrl.params></triflix-header><div class=\\\"container stats\\\"><div class=row><div class=col-xs-12><h1 class=stats__title>Game stats</h1></div></div><table class=\\\"table table-inverse\\\"><thead><tr><th>#</th><th>Player</th><th>Team</th></tr></thead><tbody><tr><th scope=row><img ng-src={{$ctrl.score.player1.facebook.img}} class=stats__img alt=\\\"\\\"></th><td>{{$ctrl.score.player1.facebook.name}}</td><td>{{$ctrl.score.teamPlayer1}}</td></tr><tr><th scope=row><img ng-src={{$ctrl.score.player2.facebook.img}} class=stats__img alt=\\\"\\\"></th><td>{{$ctrl.score.player2.facebook.name}}</td><td>{{$ctrl.score.teamPlayer2}}</td></tr></tbody></table><static-board state=$ctrl.score.state locked=true></static-board></div>\");\n$templateCache.put(\"app/components/panels/login/login.html\",\"<div class=\\\"container login\\\"><div class=row><div class=\\\"col-xs-8 col-xs-offset-2 col-sm-4 col-sm-offset-4 text-center\\\"><div ng-repeat=\\\"team in login.teams\\\" style=\\\"display: inline\\\"><span svg-icon={{team}}-icon width=64></span></div></div></div><div class=row style=\\\"margin-top: 30px\\\"><div class=\\\"col-xs-8 col-xs-offset-2 col-sm-4 col-sm-offset-4 text-center login--button login--button--local\\\" ng-click=login.continueNotLogged()>Local game</div></div><div class=row><div class=\\\"col-xs-8 col-xs-offset-2 col-sm-4 col-sm-offset-4 text-center login--button login--button--facebook\\\" ng-click=login.loginWithFacebook()>Multiplayer game <a class=\\\"btn btn-social-icon btn-facebook\\\" style=\\\"height: 32px\\\"><span class=\\\"fa fa-facebook\\\"></span></a></div></div><div class=row><div class=\\\"col-xs-8 col-xs-offset-2 col-sm-4 col-sm-offset-4 text-center login--button login--button--realtime\\\">realtime game</div></div><div class=row><div class=\\\"col-xs-8 col-xs-offset-2 col-sm-4 col-sm-offset-4 text-center login--button login--button--settings\\\" ng-click=login.openSettings()>settings</div></div></div><!--\\nhttp://localhost:3002/auth/facebook\\nhttps://triflixbe.herokuapp.com/auth/facebook\\n-->\");\n$templateCache.put(\"app/components/panels/multiplayer/multiplayer.html\",\"<triflix-header params=multiplayer.params></triflix-header><div class=\\\"container multiplayer\\\"><div class=row><div class=col-sm-12><h1>Multiplayer</h1></div></div><div class=row><div class=\\\"col-sm-6 multiplayer--box\\\" ng-repeat=\\\"user in multiplayer.usersOnline\\n    track by $index\\\"><div class=card ng-init=\\\"inviteSent = false\\\"><img ng-click=multiplayer.openProfile(user) ng-src={{user.data.facebook.img}} alt=\\\"no img\\\" class=card__img> <span class=card__name>{{user.data.facebook.name}}</span> <span class=\\\"circle animated infinite pulse\\\" ng-class=\\\"{\\'offline\\' : !user.online, \\'online\\': user.online}\\\" style=\\\"width: 15px; height: 15px\\\"></span> <img ng-if=user.fbFriend class=card__fbFriends ng-src=assets/images/fbfriends.jpg alt=\\\"no img\\\"> <button ng-show=\\\"!inviteSent && user.online\\\" ng-click=\\\"multiplayer.chooseOpponent(user); inviteSent = true\\\" class=card__cta ng-disabled=\\\"user.data.facebook.id === multiplayer.user.facebook.id\\\">Invite</button> <button ng-show=\\\"!inviteSent && !user.online\\\" ng-click=\\\"multiplayer.inviteFriend(user); inviteSent = true\\\" class=card__cta ng-disabled=\\\"user.data.facebook.id === multiplayer.user.facebook.id\\\">Invite</button> <button ng-show=inviteSent ng-disabled=inviteSent class=card__cta>Invite<br>sent</button><!--<div class=\\\"overlay\\\">\\n          <span class=\\\"circle animated infinite pulse\\\"\\n            ng-class=\\\"{\\'offline\\' : !user.online, \\'online\\': user.online}\\\"></span>\\n        </div>--></div></div></div></div>\");\n$templateCache.put(\"app/components/panels/settings/settings.html\",\"<triflix-header params=settings.params></triflix-header><div class=\\\"container settings\\\"><div class=row><div class=col-sm-12><h1>Settings <i class=\\\"fa fa-gamepad\\\" aria-hidden=true></i></h1></div></div><div class=\\\"row settings__bordered\\\"><div class=col-xs-2><div class=settings__head>Team</div></div><div class=col-xs-10><div class=\\\"settings__content pull-right\\\"><div class=settings__content__el select-option=team select-option-value=TEAM ng-repeat=\\\"TEAM in settings.teams\\\" ng-if=\\\"TEAM !== \\'\\'\\\" ng-click=\\\"settings.applySetting(\\'team\\', TEAM)\\\"><span svg-icon={{TEAM}}-icon width=64></span></div></div></div></div><div class=\\\"row settings__bordered\\\"><div class=col-xs-2><div class=settings__head>Level</div></div><div class=col-xs-10><div class=\\\"settings__content pull-right\\\"><div class=settings__content__el select-option=level select-option-value=LEVEL ng-repeat=\\\"(key, LEVEL) in settings.levels\\\" ng-click=\\\"settings.applySetting(\\'level\\', key)\\\"><span>{{LEVEL.label}}</span></div></div></div></div><div class=\\\"row settings__bordered\\\"><div class=col-xs-2><div class=settings__head>Sound</div></div><div class=col-xs-10><div class=\\\"settings__content pull-right\\\"><div class=settings__content__el select-option=sound select-option-value=SOUND ng-repeat=\\\"SOUND in [\\'on\\', \\'off\\']\\\" ng-click=\\\"settings.applySetting(\\'sound\\', SOUND)\\\"><span>{{SOUND}}</span></div></div></div></div></div>\");\n$templateCache.put(\"app/components/panels/profile/profile.html\",\"<triflix-header params=profile.params></triflix-header><div class=\\\"container profile\\\"><div class=row><div class=col-xs-12><h1 class=profile__title>Profile info <i class=\\\"fa fa-user-circle\\\" aria-hidden=true></i></h1></div></div><div class=row><div class=col-xs-6><img class=profile__img ng-src={{profile.user.facebook.img}} alt=\\\"no img\\\"></div><div class=col-xs-6><div class=\\\"profile__info pull-right\\\"><div class=row><div class=col-xs-12><span class=profile__info__name>{{profile.user.facebook.name}}</span></div></div><div class=row><div class=col-xs-12><span class=profile__info__member>Member since</span></div></div><div class=row><div class=col-xs-12><span class=profile__info__createdAt>{{profile.user.createdAt | date: \\'yyyy-MM-dd\\'}}</span></div></div><div class=row><div class=col-xs-12><span class=profile__info__badgetitle>Badges</span></div></div><div class=row><div class=col-xs-12><img class=profile__info__badge ng-src=https://cdn0.iconfinder.com/data/icons/customicondesign-office7-shadow-png/256/Metal-gold-blue.png width=64 alt=\\\"\\\"></div></div></div></div></div><div class=stats><div class=row><div class=col-xs-12><h1 class=\\\"profile__title profile__title__gamestats\\\">Game stats</h1></div></div><div class=row ng-repeat=\\\"score in profile.scores\\\" ng-if=score.opponent><div class=stats__container><div class=col-xs-4><img class=stats__opponenentImg ng-src={{score.opponent.facebook.img}} alt=\\\"no img\\\"></div><div class=col-xs-4><span class=\\\"stats__text col-xs-12 text-center\\\">vs {{score.opponent.facebook.name}}</span></div><div class=col-xs-4 ng-click=profile.openGameStats(score)><img class=\\\"stats__forwardImg pull-right\\\" ng-src=assets/images/forward.png alt=\\\"no img\\\"></div></div></div></div></div>\");}]);"],"sourceRoot":"/source/"}